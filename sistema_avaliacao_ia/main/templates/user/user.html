{% extends "base.html" %}
{% load static %}

{% block title %}Perfil - Predicto{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/dialog.css' %}">
    <link rel="stylesheet" href="{% static 'css/user_profile.css' %}">
{% endblock %}

{% block content %}
    <div class="profile-header-container">
        <h1>Perfil do Usu√°rio</h1>
        <a href="{% url 'main:user-report' %}">
            <button class="btn-report">Gerar Relat√≥rio</button>
        </a>
    </div>
    
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li style="color: {% if message.tags == 'success' %}green{% else %}red{% endif %};">
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
        <hr>
    {% endif %}

    <div class="profile-grid">
        <div class="profile-card profile-info">
            <h2>Informa√ß√µes Pessoais</h2>
            <p><strong>Nome:</strong> {{ user_data.1 }}</p>
            <p><strong>Email:</strong> {{ user_data.2 }}</p>
            <p><strong>Nascimento:</strong> {{ user_data.4|date:"d/m/Y" }}</p>
            
            <p><strong>Pa√≠s:</strong> {{ user_data.9 }}</p>
            <p><strong>Estado:</strong> {{ user_data.8 }}</p>
            <p><strong>Cidade:</strong> {{ user_data.7 }}</p>
            <p><strong>Rua:</strong> {{ user_data.6 }}</p>
            <p><strong>N√∫mero:</strong> {{ user_data.5 }}</p>
        </div>

        <div class="profile-card">
            <div class="card-header-flex">
                <h2>Conquistas</h2>
                <a href="{% url 'main:user-history' %}">
                    <button class="btn-small">Hist√≥rico</button>
                </a>
            </div>

            <div class="profile-info">
                <p><strong>ü•á Ouro:</strong> {{ user_prizes.0.1 }}</p>
                <p><strong>ü•à Prata:</strong> {{ user_prizes.1.1 }}</p>
                <p><strong>ü•â Bronze:</strong> {{ user_prizes.2.1 }}</p>
                
                <div style="margin: 10px 0; border-bottom: 1px dashed #eee;"></div>
                
                <p><strong>üí∏ Ganhos Totais:</strong> R$ {{ user_prizes.3.1|floatformat:0 }}</p>
            </div>
        </div>
    </div>
    
    <div class="profile-card" style="margin-top: 2rem;">
        <h2>Status de Organizador</h2>
        {% if is_organizer %}
            <p class="profile-status"><strong>Status:</strong> Voc√™ j√° √© um Organizador.</p>
        {% else %}
            <p class="profile-status">Torne-se um organizador para criar suas pr√≥prias competi√ß√µes.</p>
            <div class="profile-actions">
                <button type="button" id="show-dialog-btn">Tornar-se um Organizador</button>
            </div>
        {% endif %}
    </div>

    <dialog id="organizer-dialog">
        <h2>Registrar como Organizador</h2>
        <form method="post" action="{% url 'main:become-organizer' %}" class="dialog-form-container">
            {% csrf_token %}
            <label>
                CPF:
                <input type="text" name="cpf" required placeholder="000.000.000-00" maxlength="14">
            </label>
            <div class="dialog-actions">
                <button type="button" id="close-dialog-btn" class="btn-secondary">Cancelar</button>
                <button type="submit">Registrar</button>
            </div>
        </form>
    </dialog>
{% endblock %}

{% block extra_js %}
    {% if not is_organizer %}
        <script src="{% static 'js/dialog.js' %}"></script>
    {% endif %}
{% endblock %}